name: Update ZoneMinder Version

on:
  push:
    branches: [master]
  schedule:
    - cron: '0 0 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    name: Update swversion
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Update
        id: update
        run: |
          set -x
          wget \
            --no-check-certificate -qO - \
            https://api.github.com/repos/ZoneMinder/zoneminder/releases/latest \
            | awk '/tag_name/{print $4;exit}' FS='[""]' \
            > latest_version.txt
          export VERSION=`cat latest_version.txt`
          echo "::set-output name=version::${VERSION}"
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
            commit-message: Update ZoneMinder version to ${{ steps.swversionupdate.outputs.version }}
            branch: action/update-zmversion
            delete-branch: true
            title: Bump version to ${{ steps.update.outputs.version }}
            body: Bumps version to ${{ steps.update.outputs.version }}. See [ZoneMinder Releases](https://github.com/ZoneMinder/zoneminder/releases).
            labels: automated
#      - name: Bump version and push tag
#        id: tag_version
#        uses: mathieudutour/github-tag-action@v5.3
#        with:
#          github_token: ${{ secrets.GITHUB_TOKEN }}